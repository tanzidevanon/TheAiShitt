name: Windows RDP via Cloudflare

on:
  workflow_dispatch:

jobs:
  rdp:
    runs-on: windows-10
    timeout-minutes: 360

    steps:
    - name: Enable RDP
      shell: cmd
      run: |
        reg add "HKLM\System\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
        netsh advfirewall firewall set rule group="remote desktop" new enable=Yes
        net user runneradmin TempP@ss123

    - name: Download cloudflared
      shell: cmd
      run: |
        curl -L -o cloudflared.exe https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-windows-amd64.exe

    - name: Start Cloudflare Tunnel (RDP)
      shell: cmd
      env:
        TUNNEL_TOKEN: ${{ secrets.CLOUDFLARE_TUNNEL_TOKEN }}
      run: |
        echo "Starting Tunnel... Please wait."
        :: সরাসরি রান করা হবে যাতে আমরা লাইভ লগ দেখতে পাই
        cloudflared.exe tunnel run --token %TUNNEL_TOKEN%
